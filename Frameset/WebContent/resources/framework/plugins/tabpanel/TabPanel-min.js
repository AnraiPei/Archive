TabPanel=function(e){this.renderTo=e.renderTo||$(document.body),this.border=e.border,this.render=typeof this.renderTo=="string"?$("#"+this.renderTo):this.renderTo,this.widthResizable=e.widthResizable,this.heightResizable=e.heightResizable,this.autoResizable=e.autoResizable?!0:!1,this.width=e.width||"100%",this.height=e.height||"100%",this.items=e.items,this.active=e.active||0,this.tabs=[],this.scrolled=!1,this.tabWidth=114,this.fixNum=2,this.scrollFinish=!0,this.maxLength=e.maxLength||-1,this.maxzindex=0,this.init()},TabPanel.prototype={init:function(){var e=this;this.autoResizable&&(this.widthResizable=this.heightResizable=!0,this.render.css("overflow","hidden"),$(window).resize(function(){window.setTimeout(function(){e.resize()},200)})),this.render.width(this.width),this.render.height(this.height);var t=this.border!="none"?2:0;this.tabpanel=$("<DIV></DIV>"),this.tabpanel.addClass("tabpanel"),this.tabpanel.width(this.render.width()-t),this.tabpanel.height(this.render.height()-t),this.render.append(this.tabpanel),this.tabpanel_tab_content=$("<DIV></DIV>"),this.tabpanel_tab_content.addClass("tabpanel_tab_content"),this.tabpanel_tab_content.appendTo(this.tabpanel),this.tabpanel_left_scroll=$("<DIV></DIV>"),this.tabpanel_left_scroll.bind("click",function(){e.moveLeft()}),this.tabpanel_left_scroll.addClass("tabpanel_left_scroll"),this.tabpanel_left_scroll.addClass("display_none"),this.tabpanel_left_scroll.bind("mouseover",function(){var e=$(this);e.addClass("tabpanel_scroll_over"),e.bind("mouseout",function(){e.unbind("mouseout"),e.removeClass("tabpanel_scroll_over")})}),this.tabpanel_left_scroll.appendTo(this.tabpanel_tab_content),this.tabpanel_right_scroll=$("<DIV></DIV>"),this.tabpanel_right_scroll.bind("click",function(){e.moveRight()}),this.tabpanel_right_scroll.addClass("tabpanel_right_scroll"),this.tabpanel_right_scroll.addClass("display_none"),this.tabpanel_right_scroll.bind("mouseover",function(){var e=$(this);e.addClass("tabpanel_scroll_over"),e.bind("mouseout",function(){e.unbind("mouseout"),e.removeClass("tabpanel_scroll_over")})}),this.tabpanel_right_scroll.appendTo(this.tabpanel_tab_content),this.tabpanel_move_content=$("<DIV></DIV>"),this.tabpanel_move_content.addClass("tabpanel_move_content"),this.tabpanel_move_content.appendTo(this.tabpanel_tab_content),this.tabpanel_mover=$("<UL></UL>"),this.tabpanel_mover.addClass("tabpanel_mover"),this.tabpanel_mover.appendTo(this.tabpanel_move_content),this.tabpanel_tab_spacer=$("<DIV></DIV>"),this.tabpanel_tab_spacer.addClass("tabpanel_tab_spacer"),this.tabpanel_tab_spacer.appendTo(this.tabpanel_tab_content),this.tabpanel_content=$("<DIV></DIV>"),this.tabpanel_content.addClass("tabpanel_content"),this.tabpanel_content.appendTo(this.tabpanel);var n=this.tabpanel.width(),r=this.tabpanel.height();this.border=="none"&&this.tabpanel.css("border","none"),this.tabpanel_tab_content.width(n),this.tabpanel_content.width(n),this.tabpanel_content.height(r-this.tabpanel_tab_content.get(0).offsetHeight),this.update();for(var i=0;i<this.items.length;i++)this.items[i].notExecuteMoveSee=!0,this.addTab(this.items[i]);this.active>=0&&this.show(this.active,!1)},moveLeft:function(){this.scrollFinish&&(this.disableScroll(),this.scrollFinish=!1,Fader.apply(this,new Array({element:this.tabpanel_mover,style:"marginLeft",step:this.tabWidth,num:this.tabWidth,maxMove:this.maxMove,onFinish:this.useableScroll})),this.run())},moveRight:function(){this.scrollFinish&&(this.disableScroll(),this.scrollFinish=!1,Fader.apply(this,new Array({element:this.tabpanel_mover,style:"marginLeft",num:this.tabWidth*-1,step:this.tabWidth,maxMove:this.maxMove,onFinish:this.useableScroll})),this.run())},moveToLeft:function(){if(this.scrolled&&this.scrollFinish){this.disableScroll(),this.scrollFinish=!1;var e=parseInt(this.tabpanel_mover.css("marginLeft"))*-1;Fader.apply(this,new Array({element:this.tabpanel_mover,style:"marginLeft",num:e,maxMove:this.maxMove,interval:20,step:this.tabWidth,onFinish:this.useableScroll})),this.run()}},moveToRight:function(){if(this.scrolled&&this.scrollFinish){this.disableScroll(),this.scrollFinish=!1;var e=parseInt(this.tabpanel_mover.css("marginLeft"))*-1,t=this.tabpanel_mover.children().length*this.tabWidth,n=this.tabpanel_move_content.width(),r=(t-n-e+this.fixNum)*-1;Fader.apply(this,new Array({element:this.tabpanel_mover,style:"marginLeft",num:r,maxMove:this.maxMove,step:this.tabWidth,onFinish:this.useableScroll})),this.run()}},moveToSee:function(e){if(this.scrolled){var t=this.tabWidth*e,n=parseInt(this.tabpanel_mover.css("marginLeft")),r;n<=0?(r=(n+t)*-1,(r+n)*-1>=this.maxMove?this.moveToRight():(this.disableScroll(),this.scrollFinish=!1,Fader.apply(this,new Array({element:this.tabpanel_mover,style:"marginLeft",num:r,maxMove:this.maxMove,step:this.tabWidth,onFinish:this.useableScroll})),this.run())):(r=(t-n)*-1,r*-1>=this.maxMove?this.moveToRight():(this.disableScroll(),this.scrollFinish=!1,Fader.apply(this,new Array({element:this.tabpanel_mover,style:"marginLeft",step:this.tabWidth,num:r,maxMove:this.maxMove,onFinish:this.useableScroll})),this.run()))}},disableScroll:function(){this.tabpanel_left_scroll.addClass("tabpanel_left_scroll_disabled"),this.tabpanel_left_scroll.attr("disabled",!0),this.tabpanel_right_scroll.addClass("tabpanel_right_scroll_disabled"),this.tabpanel_right_scroll.attr("disabled",!0)},useableScroll:function(){var e=this;this.scrolled&&(parseInt(e.tabpanel_mover.css("marginLeft"))==0?(e.tabpanel_left_scroll.addClass("tabpanel_left_scroll_disabled"),e.tabpanel_left_scroll.attr("disabled",!0),e.tabpanel_right_scroll.removeClass("tabpanel_right_scroll_disabled"),e.tabpanel_right_scroll.removeAttr("disabled")):parseInt(e.tabpanel_mover.css("marginLeft"))*-1==e.maxMove?(e.tabpanel_left_scroll.removeClass("tabpanel_left_scroll_disabled"),e.tabpanel_left_scroll.removeAttr("disabled",!0),e.tabpanel_right_scroll.addClass("tabpanel_right_scroll_disabled"),e.tabpanel_right_scroll.attr("disabled")):(e.tabpanel_left_scroll.removeClass("tabpanel_left_scroll_disabled"),e.tabpanel_left_scroll.removeAttr("disabled",!0),e.tabpanel_right_scroll.removeClass("tabpanel_right_scroll_disabled"),e.tabpanel_right_scroll.removeAttr("disabled"))),e.scrollFinish=!0},update:function(){var e=this.tabpanel_tab_content.width();this.scrolled&&(e-=this.tabpanel_left_scroll.width()+this.tabpanel_right_scroll.width()),this.tabpanel_move_content.width(e),this.maxMove=this.tabpanel_mover.children().length*this.tabWidth-e+this.fixNum},showScroll:function(){var e=this.tabpanel_mover.children().length*this.tabWidth,t=this.tabpanel_tab_content.width();e>t&&!this.scrolled?(this.tabpanel_move_content.addClass("tabpanel_move_content_scroll"),this.tabpanel_left_scroll.removeClass("display_none"),this.tabpanel_right_scroll.removeClass("display_none"),this.scrolled=!0):e<t&&this.scrolled&&(this.moveToLeft(),this.tabpanel_move_content.removeClass("tabpanel_move_content_scroll"),this.tabpanel_left_scroll.addClass("display_none"),this.tabpanel_right_scroll.addClass("display_none"),this.scrolled=!1,this.scrollFinish=!0)},addTab:function(e){if(this.maxLength!=-1&&this.maxLength<=this.tabs.length)return $("#"+e.id).length>0?(this.show(e.id,!1),!1):(alert("您打开的标签过多，请先关闭一些标签。"),!1);e.id=e.id||Math.uuid();if($("#"+e.id).length>0)this.show(e.id,!1);else if(this.scrollFinish){var t=this,n=$("<LI></LI>");n.attr("id",e.id),n.appendTo(this.tabpanel_mover);var r=$("<DIV></DIV>");r.text(e.title),r.appendTo(n);var i=e.closable==0?0:5;e.icon?(r.addClass("icon_title"),r.css("background-image",'url("'+e.icon+'")'),r.width()>this.tabWidth-35-i&&(r.width(this.tabWidth-50-i),r.attr("title",e.title),n.append("<DIV>...</DIV>"))):(r.addClass("title"),r.width()>this.tabWidth-19-i&&(r.width(this.tabWidth-30-i),r.attr("title",e.title),n.append("<DIV>...</DIV>")));var s=$("<DIV></DIV>");s.addClass("closer"),s.attr("title","Close tab"),s.appendTo(n);var o=$("<DIV></DIV>");o.addClass("html_content"),o.appendTo(this.tabpanel_content);var u=o.find("iframe"),a=this.tabpanel_mover.children().index(this.tabpanel_mover.find(".active")[0]);a<0&&(a=0),this.tabs.length>a?e.preTabId=this.tabs[a].id:e.preTabId="",e.tab=n,e.title=r,e.closer=s,e.content=o,e.disable=e.disable==undefined?!1:e.disable,e.closable=e.closable==undefined?!0:e.closable,e.closable==0&&s.addClass("display_none"),e.disabled==1&&(n.attr("disabled",!0),r.addClass(".disabled")),this.tabs.push(e),n.bind("click",function(e){return function(){t.show(e,!1)}}(this.tabs.length-1)),s.bind("click",function(e){return function(){t.kill(e)}}(this.tabs.length-1)),e.closable&&n.bind("dblclick",function(e){return function(){t.kill(e)}}(this.tabs.length-1)),e.lazyload||this.show(this.tabs.length-1,e.notExecuteMoveSee),this.showScroll(),this.update(),!e.lazyload&&!e.notExecuteMoveSee&&this.moveToRight()}},getTabPosision:function(e){if(typeof e=="string")for(var t=0;t<this.tabs.length;t++)if(e==this.tabs[t].id){e=t;break}return e},refresh:function(e){e=this.getTabPosision(e);if(typeof e=="string")return!1;var t=this.tabs[e].content.find("iframe");if(t.length>0){var n=this.tabs[e].id+"Frame";this.iterateFlush(window.frames[n])}},iterateFlush:function(e){if(e.window.frames.length>0)for(var t=0;t<e.window.frames.length;t++)this.iterateFlush(e.window.frames[t]);else if(e.document.forms.length>0)for(var t=0;t<e.document.forms.length;t++)try{e.document.forms[t].submit()}catch(n){e.location.reload()}else e.location.reload()},show:function(e,t){if(this.tabs.length<1)return!1;e=this.getTabPosision(e),typeof e=="string"&&(e=0),this.scrollFinish&&(e>=this.tabs.length&&(e=0),this.tabs[e].content.css("z-index",++this.maxzindex),this.tabs[e].tab.hasClass("active")?t||this.moveToSee(e):(this.tabs[e].content.html()==""&&this.tabs[e].content.html(this.tabs[e].html),this.tabpanel_mover.find(".active").removeClass("active"),this.tabs[e].tab.addClass("active"),t||this.moveToSee(e)))},kill:function(e){var t=this;e=this.getTabPosision(e);var n=this.tabs[e].preTabId;this.tabs[e].closer.remove(),this.tabs[e].title.remove(),this.tabs[e].tab.remove(),this.tabs[e].content.remove();var r=$("iframe",this.tabs[e].content);if(r[0])try{r.attr("src","about:blank"),$.browser.msie&&(r[0].contentWindow.document.write(""),r[0].contentWindow.location.reload(),r[0].contentWindow.document.close()),r.remove(),$.browser.msie&&CollectGarbage()}catch(i){alert(i)}this.tabs.splice(e,1);for(var s=0;s<this.tabs.length;s++)this.tabs[s].tab.unbind("click"),this.tabs[s].tab.bind("click",function(e){return function(){t.show(e,!1)}}(s)),this.tabs[s].closer.unbind("click"),this.tabs[s].closer.bind("click",function(e){return function(){t.kill(e)}}(s)),this.tabs[s].closable&&(this.tabs[s].tab.unbind("dblclick"),this.tabs[s].tab.bind("dblclick",function(e){return function(){t.kill(e)}}(s)));this.update(),this.showScroll(),this.show(n,!1)},getTabsCount:function(){return this.tabs.length},setTitle:function(e,t){e=this.getTabPosision(e),e<this.tabs.length&&this.tabs[e].title.text(t)},getTitle:function(e){return e=this.getTabPosision(e),this.tabs[e].title.text()},setContent:function(e,t){e=this.getTabPosision(e),e<this.tabs.length&&this.tabs[e].content.html(t)},getContent:function(e){return e=this.getTabPosision(e),this.tabs[e].content.html()},setDisable:function(e,t){e=this.getTabPosision(e),e<this.tabs.length&&(this.tabs[e].disable=t,t?(this.tabs[e].tab.attr("disabled",!0),this.tabs[e].title.addClass(".disabled")):(this.tabs[e].tab.removeAttr("disabled"),this.tabs[e].title.removeClass(".disabled")))},getDisable:function(e){return e=this.getTabPosision(e),this.tabs[e].disable},setClosable:function(e,t){e=this.getTabPosision(e),e<this.tabs.length&&(this.tabs[e].closable=t,t?this.tabs[e].closer.addClass("display_none"):(this.tabs[e].closer.addClass("closer"),this.tabs[e].closer.removeClass("display_none")))},getClosable:function(e){return e=this.getTabPosision(e),this.tabs[e].closable},getActiveIndex:function(){return this.tabpanel_mover.children().index(this.tabpanel_mover.find(".active")[0])},getActiveTab:function(){var e=this.tabpanel_mover.children().index(this.tabpanel_mover.find(".active")[0]);return this.tabs.length>e?this.tabs[e]:null},resize:function(){var e=this.border=="none"?0:2;this.widthResizable&&(this.width=this.render.width(),this.tabpanel.width(this.width-e),this.tabpanel_tab_content.width(this.width-e),this.tabpanel_content.width(this.width-e)),this.heightResizable&&(this.height=this.render.height(),this.tabpanel.height(this.height-e),this.tabpanel_content.height(this.height-this.tabpanel_tab_content.get(0).offsetHeight)),this.showScroll(),this.useableScroll(),this.update();var t=this;setTimeout(function(){t.moveToSee(t.getActiveIndex())},200)},setRenderWH:function(e){e&&(e.width!=undefined&&this.render.width(e.width),e.height!=undefined&&this.render.height(e.height),this.resize())}}